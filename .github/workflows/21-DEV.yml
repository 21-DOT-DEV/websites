name: 21-dev

on:
  push:
    branches:
      - 'main'
    paths: &paths
      - '.github/workflows/build-slipstream.yml'
      - '.github/workflows/deploy-cloudflare.yml'
      - '.github/workflows/21-DEV.yml'
      - 'Sources/21-dev/**'
      - 'Resources/21-dev/**'
      - 'Sources/DesignSystem/**'
      - 'Tests/**'
      - 'Package.swift'

  pull_request:
    branches:
      - 'main'
    paths: *paths

  workflow_dispatch:

jobs:
  build:
    name: Build Site
    uses: ./.github/workflows/build-slipstream.yml
    with:
      website: 21-dev
  
  deploy:
    name: Deploy Site
    needs: build
    uses: ./.github/workflows/deploy-cloudflare.yml
    with:
      artifact-name: ${{ needs.build.outputs.artifact-name }}
      project-name: 21-dev
      deploy-to-production: ${{ github.event_name == 'push' && github.ref == 'refs/heads/main' }}
    secrets:
      cloudflare-api-token: ${{ secrets.CLOUDFLARE_API_TOKEN }}
      cloudflare-account-id: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
